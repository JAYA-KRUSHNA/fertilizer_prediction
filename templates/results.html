<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - CropWise AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
</head>

<body>
    <header>
        <nav>
            <div class="nav-container">
                <div class="nav-logo">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="CropWise AI" class="logo-img">
                    <span>CropWise AI</span>
                </div>
                <div class="nav-hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul class="nav-menu">
                    <li><a href="{{ url_for('home') }}"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="{{ url_for('predict') }}"><i class="fas fa-calculator"></i> Predict</a></li>
                    <li><a href="{{ url_for('visualization') }}"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                    <li><a href="{{ url_for('about') }}"><i class="fas fa-info-circle"></i> About</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <!-- Premium Hero Section -->
        <section class="results-hero">
            <div class="container">
                <div class="results-hero-badge"><i class="fas fa-sparkles"></i> PREDICTION COMPLETE</div>
                <h1>Your Results</h1>
                <p>AI-powered fertilizer recommendations tailored to your field</p>
            </div>
            <!-- Decorative floating particles -->
            <div class="results-hero-deco deco-1"></div>
            <div class="results-hero-deco deco-2"></div>
            <div class="results-hero-deco deco-3"></div>
        </section>

        <section class="results-section">
            <div class="container">
                {% if prediction and 'error' not in prediction %}
                <div class="results-premium-container">

                    <!-- Main Result Card -->
                    <div class="result-main-card animate-in">
                        <div class="result-main-card-glow"></div>
                        <div class="result-badge-row">
                            <span class="result-status-badge">
                                <i class="fas fa-check-circle"></i> Optimal Dosage Calculated
                            </span>
                        </div>
                        <div class="result-amount-display">
                            <div class="result-amount-ring">
                                <svg viewBox="0 0 120 120">
                                    <circle cx="60" cy="60" r="52" fill="none" stroke="rgba(76,175,80,0.12)"
                                        stroke-width="6" />
                                    <circle cx="60" cy="60" r="52" fill="none" stroke="url(#resultGradient)"
                                        stroke-width="6" stroke-dasharray="327" stroke-dashoffset="16"
                                        stroke-linecap="round" transform="rotate(-90 60 60)"
                                        class="result-ring-animated" />
                                    <defs>
                                        <linearGradient id="resultGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" stop-color="#4caf50" />
                                            <stop offset="100%" stop-color="#00e676" />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <div class="result-amount-inner">
                                    <span class="result-amount-number" data-target="{{ prediction.get('predicted_fertilizer', 0) | round(1) }}">0</span>
                                    <span class="result-amount-unit">kg/ha</span>
                                </div>
                            </div>
                            <div class="result-amount-caption">
                                <i class="fas fa-leaf"></i> Recommended fertilizer amount for <strong>{{ prediction.get('crop_type', 'your crop') }}</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Parameters Grid -->
                    <div class="results-params-section animate-in" style="animation-delay: 0.15s;">
                        <div class="results-section-header">
                            <div class="results-section-icon"><i class="fas fa-sliders-h"></i></div>
                            <div>
                                <h3>Input Parameters</h3>
                                <p>The values used for this prediction</p>
                            </div>
                        </div>
                        <div class="results-params-grid">
                            <div class="result-param-card">
                                <div class="param-card-icon soil"><i class="fas fa-seedling"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Crop Type</span>
                                    <span class="param-card-value">{{ prediction.get('crop_type', 'N/A') }}</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon ph"><i class="fas fa-tint"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Soil pH</span>
                                    <span class="param-card-value">{{ prediction.get('soil_ph', 'N/A') }}</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon texture"><i class="fas fa-layer-group"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Soil Texture</span>
                                    <span class="param-card-value">{{ prediction.get('soil_texture', 'N/A') }}</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon irrigation"><i class="fas fa-water"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Irrigation</span>
                                    <span class="param-card-value">{{ prediction.get('irrigation_type', 'N/A') }}</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon temp"><i class="fas fa-thermometer-half"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Temperature</span>
                                    <span class="param-card-value">{{ prediction.get('temperature', 0) | round(1) }}Â°C</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon humidity"><i class="fas fa-tint"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Humidity</span>
                                    <span class="param-card-value">{{ prediction.get('humidity', 0) | round(1) }}%</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon rain"><i class="fas fa-cloud-rain"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Rainfall</span>
                                    <span class="param-card-value">{{ prediction.get('rainfall', 0) | round(1) }} mm</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon nitrogen"><i class="fas fa-atom"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Nitrogen</span>
                                    <span class="param-card-value">{{ prediction.get('nitrogen', 0) | round(1) }} kg/ha</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon phosphorus"><i class="fas fa-atom"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Phosphorus</span>
                                    <span class="param-card-value">{{ prediction.get('phosphorus', 0) | round(1) }} kg/ha</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon potassium"><i class="fas fa-atom"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Potassium</span>
                                    <span class="param-card-value">{{ prediction.get('potassium', 0) | round(1) }} kg/ha</span>
                                </div>
                            </div>
                            <div class="result-param-card">
                                <div class="param-card-icon organic"><i class="fas fa-leaf"></i></div>
                                <div class="param-card-info">
                                    <span class="param-card-label">Organic Matter</span>
                                    <span class="param-card-value">{{ prediction.get('organic_matter', 0) | round(1) }}%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Feature Importance / Factor Analysis -->
                    {% if prediction.get('feature_importance') and prediction.get('feature_importance')|length > 0 %}
                    <div class="results-factors-section animate-in" style="animation-delay: 0.3s;">
                        <div class="results-section-header">
                            <div class="results-section-icon factors"><i class="fas fa-chart-pie"></i></div>
                            <div>
                                <h3>Key Influencing Factors</h3>
                                <p>Understanding what most influenced this prediction</p>
                            </div>
                        </div>
                        <div class="results-factors-layout">
                            <div class="results-chart-wrapper">
                                <canvas id="factors-chart" width="400" height="300"></canvas>
                            </div>
                            <div class="results-factors-bars">
                                {% for factor in prediction.get('feature_importance') %}
                                <div class="result-factor-item"
                                    data-importance="{{ (factor.get('importance', 0) * 100) | round(1) }}">
                                    <div class="factor-item-header">
                                        <span class="factor-item-name">{{ factor.get('name', 'N/A') }}</span>
                                        <span class="factor-item-pct">{{ (factor.get('importance', 0) * 100) | round(1) }}%</span>
                                    </div>
                                    <div class="factor-item-track">
                                        <div class="factor-item-fill"></div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Premium Recommendations -->
                    <div class="results-recommendations-section animate-in" style="animation-delay: 0.45s;">
                        <div class="results-section-header">
                            <div class="results-section-icon recs"><i class="fas fa-lightbulb"></i></div>
                            <div>
                                <h3>Smart Recommendations</h3>
                                <p>Expert insights based on your prediction</p>
                            </div>
                        </div>
                        <div class="results-recs-grid">
                            <div class="result-rec-card">
                                <div class="rec-card-header strategy">
                                    <div class="rec-card-icon"><i class="fas fa-bullseye"></i></div>
                                    <h4>Application Strategy</h4>
                                </div>
                                <ul>
                                    <li><i class="fas fa-check"></i> Apply fertilizer in split doses for better absorption</li>
                                    <li><i class="fas fa-check"></i> Consider soil test results for precise nutrient balance</li>
                                    <li><i class="fas fa-check"></i> Monitor plant response and adjust as needed</li>
                                </ul>
                            </div>
                            <div class="result-rec-card">
                                <div class="rec-card-header environment">
                                    <div class="rec-card-icon"><i class="fas fa-globe-americas"></i></div>
                                    <h4>Environmental Impact</h4>
                                </div>
                                <ul>
                                    <li><i class="fas fa-check"></i> This recommendation optimizes resource use</li>
                                    <li><i class="fas fa-check"></i> Reduces potential nutrient runoff</li>
                                    <li><i class="fas fa-check"></i> Supports sustainable farming practices</li>
                                </ul>
                            </div>
                            <div class="result-rec-card">
                                <div class="rec-card-header cost">
                                    <div class="rec-card-icon"><i class="fas fa-coins"></i></div>
                                    <h4>Cost Optimization</h4>
                                </div>
                                <ul>
                                    <li><i class="fas fa-check"></i> Avoids over-fertilization waste</li>
                                    <li><i class="fas fa-check"></i> Maximizes return on investment</li>
                                    <li><i class="fas fa-check"></i> Reduces input costs per unit yield</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Action Buttons -->
                    <div class="results-actions-premium animate-in" style="animation-delay: 0.6s;">
                        <a href="{{ url_for('predict') }}" class="btn-results-primary">
                            <span class="btn-results-icon"><i class="fas fa-redo"></i></span>
                            <span>Make Another Prediction</span>
                            <span class="btn-shimmer"></span>
                        </a>
                        <a href="{{ url_for('visualization') }}" class="btn-results-secondary">
                            <i class="fas fa-chart-bar"></i> View Analytics
                        </a>
                        <button onclick="window.print()" class="btn-results-secondary">
                            <i class="fas fa-print"></i> Print Results
                        </button>
                    </div>
                </div>

                {% elif prediction and 'error' in prediction %}
                <div class="results-error-card animate-in">
                    <div class="error-icon-ring">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2>Prediction Failed</h2>
                    <p class="error-detail">{{ prediction.error }}</p>
                    <p>Please check your input values and try again.</p>
                    <a href="{{ url_for('predict') }}" class="btn-results-primary">
                        <span class="btn-results-icon"><i class="fas fa-calculator"></i></span>
                        <span>Try Again</span>
                        <span class="btn-shimmer"></span>
                    </a>
                </div>

                {% else %}
                <div class="results-error-card animate-in">
                    <div class="error-icon-ring warning">
                        <i class="fas fa-search"></i>
                    </div>
                    <h2>No Prediction Data Found</h2>
                    <p>Please go back and make a fertilizer prediction first.</p>
                    <a href="{{ url_for('predict') }}" class="btn-results-primary">
                        <span class="btn-results-icon"><i class="fas fa-calculator"></i></span>
                        <span>Make Prediction</span>
                        <span class="btn-shimmer"></span>
                    </a>
                </div>
                {% endif %}
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-wave">
            <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
                <path d="M0,60 C360,120 720,0 1080,60 C1260,90 1380,60 1440,60 L1440,120 L0,120Z" fill="currentColor" />
            </svg>
        </div>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section footer-brand">
                    <h3><i class="fas fa-seedling"></i> CropWise AI</h3>
                    <p>Revolutionizing agriculture through intelligent fertilizer management. Built with cutting-edge ML
                        for a sustainable future.</p>
                    <div class="social-links">
                        <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="{{ url_for('home') }}"><i class="fas fa-angle-right"></i> Home</a></li>
                        <li><a href="{{ url_for('visualization') }}"><i class="fas fa-angle-right"></i> View
                                Analytics</a></li>
                        <li><a href="{{ url_for('about') }}"><i class="fas fa-angle-right"></i> Learn More</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p><i class="fas fa-envelope"></i> jayakrushna1622@gmail.com</p>
                    <p><i class="fas fa-phone"></i> +91 9392427419</p>
                    <p><i class="fas fa-map-marker-alt"></i> India</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 CropWise AI. All rights reserved. Built with <i class="fas fa-heart"
                        style="color: #e53935;"></i> for sustainable agriculture.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Count-up Animation for Result Number ---
            const amountEl = document.querySelector('.result-amount-number');
            if (amountEl) {
                const target = parseFloat(amountEl.getAttribute('data-target'));
                if (!isNaN(target) && target > 0) {
                    const duration = 1800;
                    const startTime = performance.now();
                    function animate(currentTime) {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        // Ease-out cubic
                        const eased = 1 - Math.pow(1 - progress, 3);
                        amountEl.textContent = (target * eased).toFixed(1);
                        if (progress < 1) {
                            requestAnimationFrame(animate);
                        }
                    }
                    requestAnimationFrame(animate);
                } else {
                    amountEl.textContent = '0';
                }
            }

            // --- Animated Factor Bars ---
            const factorItems = document.querySelectorAll('.result-factor-item');
            const chartLabels = [];
            const chartData = [];
            const chartColors = ['#4caf50', '#2196f3', '#ff9800', '#e91e63', '#9c27b0', '#00bcd4', '#ff5722', '#795548', '#607d8b', '#3f51b5', '#cddc39'];

            factorItems.forEach((item, index) => {
                const importance = item.getAttribute('data-importance');
                const nameElement = item.querySelector('.factor-item-name');

                if (importance) {
                    const fillBar = item.querySelector('.factor-item-fill');
                    if (fillBar) {
                        // Staggered animation
                        setTimeout(() => {
                            fillBar.style.width = importance + '%';
                        }, 400 + index * 100);
                    }
                    chartLabels.push(nameElement ? nameElement.textContent.trim() : `Factor ${index + 1}`);
                    chartData.push(parseFloat(importance));
                }
            });

            // --- Factors Doughnut Chart ---
            const canvas = document.getElementById('factors-chart');
            if (canvas && chartLabels.length > 0) {
                const ctx = canvas.getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: chartLabels.slice(0, 6),
                        datasets: [{
                            data: chartData.slice(0, 6),
                            backgroundColor: chartColors.slice(0, 6),
                            borderWidth: 0,
                            hoverBorderWidth: 3,
                            hoverBorderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 16,
                                    font: { size: 12, weight: '600' },
                                    usePointStyle: true,
                                    pointStyleWidth: 10
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(30,30,30,0.9)',
                                titleFont: { weight: '700' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                cornerRadius: 10,
                                callbacks: {
                                    label: function (context) {
                                        return ' ' + context.label + ': ' + context.parsed.toFixed(1) + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            } else if (canvas) {
                canvas.parentElement.innerHTML = '<p style="text-align:center;color:#94a3b8;padding:2rem;font-size:0.9rem;">Feature importance data not available.</p>';
            }

            // --- Staggered entrance animations ---
            const animateEls = document.querySelectorAll('.animate-in');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.05 });
            animateEls.forEach(el => observer.observe(el));
        });
    </script>
</body>

</html>